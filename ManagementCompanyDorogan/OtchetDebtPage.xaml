<Page x:Class="ManagementCompanyDorogan.OtchetDebtPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Отчет по задолженностям" 
      Background="White"
      FontFamily="Segoe UI"
      Loaded="Page_Loaded">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <Border Grid.Row="0" Background="#67BA80" Padding="15">
            <TextBlock Text="Отчет по задолженностям" 
                       FontSize="22" FontWeight="Bold" Foreground="White"
                       HorizontalAlignment="Center"/>
        </Border>

        <!-- Таблица с отчетами -->
        <DataGrid x:Name="dgDebtReport" Grid.Row="1" Margin="10"
                  AutoGenerateColumns="False" IsReadOnly="True"
                  SelectionMode="Single" AlternatingRowBackground="#F9F9F9">

            <DataGrid.Columns>
                <!-- Адрес -->
                <DataGridTextColumn Header="Адрес" Binding="{Binding Adress}" Width="250"/>

                <!-- Владелец -->
                <DataGridTextColumn Header="Владелец" Binding="{Binding OwnerName}" Width="200"/>

                <!-- Номер квартиры -->
                <DataGridTextColumn Header="Квартира" Binding="{Binding Apartment}" Width="80"/>

                <!-- Вода -->
                <DataGridTextColumn Header="Вода (₽)" Binding="{Binding Water, StringFormat=N2}" Width="100"/>

                <!-- Электричество -->
                <DataGridTextColumn Header="Электричество (₽)" Binding="{Binding Electricity, StringFormat=N2}" Width="120"/>

                <!-- Общая задолженность -->
                <DataGridTextColumn Header="Общий долг (₽)" Binding="{Binding TotalDebt, StringFormat=N2}" Width="120">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="Red"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Статистика -->
        <Border Grid.Row="2" Background="#F4E8D3" Padding="10">
            <StackPanel>
                <WrapPanel HorizontalAlignment="Center" Margin="0,0,0,10">
                    <TextBlock x:Name="txtTotalDebtors" Text="Всего должников: 0" 
                               FontSize="14" FontWeight="SemiBold"
                               Margin="10,0"/>

                    <TextBlock x:Name="txtTotalWater" Text="Вода: 0 ₽" 
                               FontSize="14" FontWeight="SemiBold"
                               Margin="10,0"/>

                    <TextBlock x:Name="txtTotalElectricity" Text="Электричество: 0 ₽" 
                               FontSize="14" FontWeight="SemiBold"
                               Margin="10,0"/>

                    <TextBlock x:Name="txtTotalAll" Text="Общая сумма: 0 ₽" 
                               FontSize="14" FontWeight="Bold"
                               Foreground="Red"
                               Margin="10,0"/>
                </WrapPanel>

                <WrapPanel HorizontalAlignment="Center">
                    <!-- Кнопка Обновить -->
                    <Button Content="🔄 Обновить" 
                            x:Name="btnRefresh"
                            Width="120" Height="35"
                            Background="#67BA80" Foreground="White"
                            FontSize="13" FontWeight="SemiBold"
                            Click="btnRefresh_Click"
                            Margin="5"
                            Cursor="Hand"
                            ToolTip="Обновить отчет">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="border" 
                                                    Background="{TemplateBinding Background}">
                                                <ContentPresenter HorizontalAlignment="Center" 
                                                                VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="#5AA66F"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>

                    <!-- Кнопка Экспорт -->
                    <Button Content="📄 Экспорт" 
                            x:Name="btnExport"
                            Width="120" Height="35"
                            Background="#6C757D" Foreground="White"
                            FontSize="13" FontWeight="SemiBold"
                            Click="btnExport_Click"
                            Margin="5"
                            Cursor="Hand"
                            ToolTip="Экспортировать отчет в файл">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="border" 
                                                    Background="{TemplateBinding Background}">
                                                <ContentPresenter HorizontalAlignment="Center" 
                                                                VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="#5A6268"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>

                    <!-- Кнопка Крупные долги -->
                    <Button Content="⚠️ Крупные долги" 
                            x:Name="btnLargeDebts"
                            Width="140" Height="35"
                            Background="#FFCC00" Foreground="Black"
                            FontSize="13" FontWeight="SemiBold"
                            Click="btnLargeDebts_Click"
                            Margin="5"
                            Cursor="Hand"
                            ToolTip="Показать задолженности более 10,000 ₽">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="border" 
                                                    Background="{TemplateBinding Background}">
                                                <ContentPresenter HorizontalAlignment="Center" 
                                                                VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="#E6B800"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>
                </WrapPanel>
            </StackPanel>
        </Border>
    </Grid>
</Page>