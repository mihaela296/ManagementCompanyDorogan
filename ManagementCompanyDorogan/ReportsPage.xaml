<Page x:Class="ManagementCompanyDorogan.ReportsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Title="Отчёты" 
      Background="White"
      FontFamily="Segoe UI"
      Loaded="Page_Loaded">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <Border Grid.Row="0" Background="#6C757D" Padding="15">
            <TextBlock Text="Отчёты по оплате" 
                       FontSize="22" FontWeight="Bold" Foreground="White"
                       HorizontalAlignment="Center"/>
        </Border>

        <!-- Таблица -->
        <DataGrid x:Name="dgReports" Grid.Row="1" Margin="10"
                  AutoGenerateColumns="False" IsReadOnly="True"
                  SelectionMode="Single" AlternatingRowBackground="#F9F9F9"
                  SelectionChanged="dgReports_SelectionChanged">

            <DataGrid.Columns>
                <!-- ID -->
                <DataGridTextColumn Header="ID" Binding="{Binding PaymentId}" Width="50"/>

                <!-- Адрес -->
                <DataGridTextColumn Header="Адрес" Binding="{Binding Adress}" Width="200"/>

                <!-- Период -->
                <DataGridTextColumn Header="Период" Binding="{Binding Period}" Width="150"/>

                <!-- Начислено -->
                <DataGridTextColumn Header="Начислено" 
                                  Binding="{Binding Accrued, StringFormat=N2}" 
                                  Width="100"/>

                <!-- Оплачено -->
                <DataGridTextColumn Header="Оплачено" 
                                  Binding="{Binding Paid, StringFormat=N2}" 
                                  Width="100">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Paid}" Value="0">
                                    <Setter Property="Foreground" Value="Red"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Paid}" Value="1">
                                    <Setter Property="Foreground" Value="Green"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Кнопка редактирования -->
                <DataGridTemplateColumn Header="Действия" Width="120">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="✏️ Редактировать" 
                                    Height="30" Padding="5"
                                    Click="EditButton_Click"
                                    ToolTip="Редактировать запись об оплате"
                                    Cursor="Hand"
                                    Background="Transparent" 
                                    Foreground="#6C757D"
                                    BorderBrush="#6C757D" 
                                    BorderThickness="1"
                                    FontSize="11">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="border" 
                                                            Background="{TemplateBinding Background}"
                                                            BorderBrush="{TemplateBinding BorderBrush}"
                                                            BorderThickness="{TemplateBinding BorderThickness}">
                                                        <ContentPresenter HorizontalAlignment="Center" 
                                                                        VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="border" Property="Background" Value="#E8F5E9"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Статистика и кнопки управления -->
        <Border Grid.Row="2" Background="#F8F9FA" Padding="15">
            <StackPanel>
                <!-- Статистика -->
                <WrapPanel HorizontalAlignment="Center" Margin="0,0,0,10">
                    <TextBlock x:Name="txtTotal" Text="Всего: 0 записей" 
                               Margin="10,0" FontWeight="SemiBold" FontSize="14"/>
                    <TextBlock x:Name="txtSum" Text="Сумма: 0 ₽" 
                               Margin="10,0" FontWeight="SemiBold" FontSize="14"/>
                    <TextBlock x:Name="txtPaid" Text="Оплачено: 0" 
                               Margin="10,0" FontWeight="SemiBold" FontSize="14" Foreground="Green"/>
                    <TextBlock x:Name="txtDebts" Text="Долги: 0" 
                               Margin="10,0" FontWeight="SemiBold" FontSize="14" Foreground="Red"/>
                    <TextBlock x:Name="txtSelected" Text="Выбрано: 0" 
                               Margin="10,0" FontWeight="SemiBold" FontSize="14" Foreground="#6C757D"/>
                </WrapPanel>

                <!-- Кнопки управления -->
                <WrapPanel HorizontalAlignment="Center">
                    <!-- Кнопка Добавить -->
                    <Button Content="➕ Добавить отчет" 
                            Width="140" Height="35" FontSize="13" FontWeight="SemiBold"
                            Background="#6C757D" Foreground="White" BorderThickness="0"
                            Click="btnAdd_Click" Margin="5" Cursor="Hand"
                            ToolTip="Добавить новый отчет по оплате">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="border" Background="{TemplateBinding Background}">
                                    <ContentPresenter HorizontalAlignment="Center" 
                                                    VerticalAlignment="Center" 
                                                    Margin="{TemplateBinding Padding}"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#5A6268"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>

                    <!-- Кнопка Удалить -->
                    <Button Content="🗑️ Удалить" 
                            x:Name="btnDelete"
                            Width="120" Height="35" FontSize="13" FontWeight="SemiBold"
                            Background="#DC3545" Foreground="White" BorderThickness="0"
                            Click="btnDelete_Click" Margin="5" Cursor="Hand"
                            ToolTip="Удалить выбранный отчет"
                            IsEnabled="False">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="border" Background="{TemplateBinding Background}">
                                    <ContentPresenter HorizontalAlignment="Center" 
                                                    VerticalAlignment="Center" 
                                                    Margin="{TemplateBinding Padding}"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#C82333"/>
                                    </Trigger>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter TargetName="border" Property="Opacity" Value="0.5"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>

                    <!-- Кнопка Обновить -->
                    <Button Content="🔄 Обновить" 
                            Width="120" Height="35" FontSize="13" FontWeight="SemiBold"
                            Background="#67BA80" Foreground="White" BorderThickness="0"
                            Click="Refresh_Click" Margin="5" Cursor="Hand"
                            ToolTip="Обновить список отчетов">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="border" Background="{TemplateBinding Background}">
                                    <ContentPresenter HorizontalAlignment="Center" 
                                                    VerticalAlignment="Center" 
                                                    Margin="{TemplateBinding Padding}"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#5AA66F"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </WrapPanel>
            </StackPanel>
        </Border>
    </Grid>
</Page>